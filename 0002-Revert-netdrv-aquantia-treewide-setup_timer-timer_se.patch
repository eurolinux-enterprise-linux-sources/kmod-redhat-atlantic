From caa1ec5af0556fc4ec6b32742b69ef1d7415240c Mon Sep 17 00:00:00 2001
From: Eugene Syromiatnikov <esyr@redhat.com>
Date: Tue, 26 Jun 2018 18:02:14 +0200
Subject: [PATCH] Revert "[netdrv] aquantia: treewide: setup_timer() ->
 timer_setup()"

This reverts commit 675524e5d17034475b253dcb115f47931cb46909.
---
 drivers/net/ethernet/aquantia/atlantic/aq_nic.c | 14 ++++++++------
 1 file changed, 8 insertions(+), 6 deletions(-)

diff --git a/drivers/net/ethernet/aquantia/atlantic/aq_nic.c b/drivers/net/ethernet/aquantia/atlantic/aq_nic.c
index 98f375f11b5c..5b5bfa1f5ce5 100644
--- a/drivers/net/ethernet/aquantia/atlantic/aq_nic.c
+++ b/drivers/net/ethernet/aquantia/atlantic/aq_nic.c
@@ -152,9 +152,9 @@ static int aq_nic_update_link_status(struct aq_nic_s *self)
 	return 0;
 }
 
-static void aq_nic_service_timer_cb(struct timer_list *t)
+static void aq_nic_service_timer_cb(unsigned long param)
 {
-	struct aq_nic_s *self = from_timer(self, t, service_timer);
+	struct aq_nic_s *self = (struct aq_nic_s *)param;
 	int ctimer = AQ_CFG_SERVICE_TIMER_INTERVAL;
 	int err = 0;
 
@@ -178,9 +178,9 @@ err_exit:
 	mod_timer(&self->service_timer, jiffies + ctimer);
 }
 
-static void aq_nic_polling_timer_cb(struct timer_list *t)
+static void aq_nic_polling_timer_cb(unsigned long param)
 {
-	struct aq_nic_s *self = from_timer(self, t, polling_timer);
+	struct aq_nic_s *self = (struct aq_nic_s *)param;
 	struct aq_vec_s *aq_vec = NULL;
 	unsigned int i = 0U;
 
@@ -325,12 +325,14 @@ int aq_nic_start(struct aq_nic_s *self)
 	err = aq_nic_update_interrupt_moderation_settings(self);
 	if (err)
 		goto err_exit;
-	timer_setup(&self->service_timer, aq_nic_service_timer_cb, 0);
+	setup_timer(&self->service_timer, &aq_nic_service_timer_cb,
+		    (unsigned long)self);
 	mod_timer(&self->service_timer, jiffies +
 			AQ_CFG_SERVICE_TIMER_INTERVAL);
 
 	if (self->aq_nic_cfg.is_polling) {
-		timer_setup(&self->polling_timer, aq_nic_polling_timer_cb, 0);
+		setup_timer(&self->polling_timer, &aq_nic_polling_timer_cb,
+			    (unsigned long)self);
 		mod_timer(&self->polling_timer, jiffies +
 			  AQ_CFG_POLLING_TIMER_INTERVAL);
 	} else {
-- 
2.13.6

